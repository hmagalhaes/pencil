var ui={ANIM:300,MODE_ALL:"dial notes",MODE_DEFAULT:"",MODE_DIAL:"dial",MODE_NOTES:"notes",htmlContainer:null,initializing:!1,loaded:!1,init:function(){this.initializing=!0,this.htmlContainer=$("html"),this.loading.init(),this.pages.init(),this.frame.init(),this.notes.init(),this.dial.init(),this.panel.init(),document.addEventListener("keydown",function(i){ui.keyDown(i.which||i.keyCode)}),document.addEventListener("keyup",function(i){ui.keyUp(i.which||i.keyCode)}),ui.reset(),ui.checkUrl(),this.initializing=!1,this.load()},load:function(){this.loaded||this.initializing||(this.loading.hide(),this.loaded=!0)},loading:{init:function(){this.container=$(document.body).children("#loading"),this.container.children("p").html(lang.loading.msg)},hide:function(){this.container.remove()}},pages:{pages:[],pageMap:{},currentPage:null,lastShownPageId:null,init:function(){this.container=$(document.body).children("#dial>div>div")},addPage:function(i){i.find(".img>img");var t={id:i.attr("_id"),index:this.pages.length,title:i.children("h2"),notes:i.children(".notes"),image:{el:i.find(".img>img"),getURL:function(){return this.el.prop("src")},getWidth:function(){return this.el.attr("_width")},getHeight:function(){return this.el.attr("_height")}},getTitle:function(){var i=$.trim(this.title.html());return""!=i?i:lang.page.dfTitle},getNotes:function(){return $.trim(this.notes.html())}};return ui.pages.pages.push(t),ui.pages.pageMap[t.id]=t},loadPage:function(i){var t=this.pageMap[i];return!!t&&(this.currentPage=t,this.lastShownPageId=i,!0)}},frame:{init:function(){this.container=$(document.body).children("#frame"),this.imageFrame=this.container.find(".img-frame"),this.currentImg=null,this.hide()},loadPage:function(){var i=ui.pages.currentPage;this.imageFrame.empty().prepend("<img src='"+i.image.getURL()+"' width='"+i.image.getWidth()+"' height='"+i.image.getHeight()+"' usemap='#map_"+i.id+"'/>")},show:function(){this.container.show(ui.ANIM)},hide:function(){this.container.hide(ui.ANIM)},showHotspots:function(){this.hideHotspots();var i=this.imageFrame.find(">img"),d=$("<canvas></canvas>").attr("width",i.width()).attr("height",i.height()).appendTo(this.imageFrame).get(0).getContext("2d");d.fillStyle="rgba(0, 255, 249, 0.4)";var t="map[name=map_"+ui.pages.currentPage.id+"]";$(t).find(">area").each(function(i,t){var e=$(t).attr("coords");if(null!=e&&""!=$.trim(e)){var n=e.split(","),a=parseInt(n[0]),s=parseInt(n[1]),o=parseInt(n[2])-a,h=parseInt(n[3])-s;d.fillRect(a,s,o,h)}})},hideHotspots:function(){this.imageFrame.find("canvas").remove()}},notes:{init:function(){this.container=$(document.body).children("#notes");var i=this.container.children("div");this.title=i.children("h1"),this.text=i.children("div"),this.hide()},load:function(){this.title.html(ui.pages.currentPage.getTitle()),this.text.html(ui.pages.currentPage.getNotes())},show:function(){this.load(),this.container.show(ui.ANIM)},hide:function(){this.container.hide(ui.ANIM)}},dial:{init:function(){this.container=$(document.body).children("#dial");var i=this.container.children("div");i.children("div").children(".page").each(function(i){var t=$(this),e=ui.pages.addPage(t);t.data("id",e.id).prop("title",lang.dial.linkTitle).bind("click",function(){ui.goToPage($(this).data("id")),ui.reset()})}),i.children("h1").html(lang.dial.title),this.hide()},show:function(){this.container.show(ui.ANIM)},hide:function(){this.container.hide()}},panel:{init:function(){this.container=$(document.body).children("#panel"),this.hide();var i=this.container.children("div");this.title=i.children("h1");var t=this.container.find(".buttons");this.buttons={notes:t.children(".notes"),home:t.children(".home"),dial:t.children(".dial"),back:t.children(".back")},this.buttons.home.prop("title",lang.panel.buttons.home),this.buttons.dial.prop("title",lang.panel.buttons.dial),this.buttons.back.prop("title",lang.panel.buttons.back),this.buttons.notes.bind("click",function(){$(this).hasClass("disabled")||(ui.frame.hide(),ui.notes.show(),ui.setMode(ui.MODE_NOTES))}),this.buttons.home.bind("click",function(){ui.goToFirstPage()}),this.buttons.dial.bind("click",function(){ui.frame.hide(),ui.dial.show(),ui.setMode(ui.MODE_DIAL)}),this.buttons.back.bind("click",function(){ui.reset()})},loadPage:function(){this.title.html(ui.pages.currentPage.getTitle()),""==ui.pages.currentPage.getNotes()?(this.buttons.notes.addClass("disabled"),this.buttons.notes.prop("title",lang.panel.buttons.notesEmpty)):(this.buttons.notes.removeClass("disabled"),this.buttons.notes.prop("title",lang.panel.buttons.notes))},setMode:function(i){this.container.removeClass(ui.MODE_ALL),this.container.addClass(i)},show:function(){this.container.show()},hide:function(){}},setMode:function(i){this.htmlContainer.removeClass(this.MODE_ALL),this.htmlContainer.addClass(i),this.panel.setMode(i)},reset:function(){this.dial.hide(),this.notes.hide(),this.frame.show(),this.panel.show(),this.setMode(this.MODE_DEFAULT)},keyDown:function(i){27==i&&this.reset(),16==i&&this.frame.showHotspots()},keyUp:function(i){16==i&&this.frame.hideHotspots()},loadPage:function(i){this.pages.loadPage(i)&&(this.panel.loadPage(),this.frame.loadPage())},goToPage:function(i){window.location.href="#"+i},goToFirstPage:function(){var i=this.pages.pages[0];this.goToPage(i.id),this.loadPage(i.id)},checkUrl:function(){try{if(window.location.href.match(/#(.*)$/)){var i=RegExp.$1;this.pages.lastShownPageId!=i&&this.loadPage(i)}else 0<this.pages.pages.length&&this.goToFirstPage()}catch(i){throw i}finally{window.setTimeout(function(){ui.checkUrl()},200)}}};$(function(){ui.init()}),$(window).load(function(){ui.load()});
